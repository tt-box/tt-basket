<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../tt-price/tt-price.html">

<!--
`tt-basket`
Polymer Basket Element

@demo demo/index.html 
-->

<dom-module id="tt-basket">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            :host {
                display: block;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            iron-list {
                flex: 1 1 auto;
            }

            iron-list {
                --iron-list-items-container: {
                    margin: 1px;
                };
            }

            .orderItem {
                @apply(--layout-horizontal);
            }

        </style>

        <iron-list id="list" items="[[orderItems]]" as="item" on-tap="_handleOnTapOrderItem">
            <template>
                <div class="orderItem" tabindex$="[[tabIndex]]">
                    <div class="flex">[[item.product.name]]</div>
                    <tt-price price="[[item.price]]"></tt-price>
                </div>
            </template>
        </iron-list>

        <div>
            <div>Total</div>
            <div>
                <tt-price price="[[total]]"></tt-price>
            </div>
        </div>

    </template>

    <script>
        Polymer({

            is: 'tt-basket',

            properties: {
                orderItems: {
                    type: Array,
                    value: function () {
                        return {};
                    },
                },
                total: {
                    type: Object,
                    computed: '_computeTotalAmount(orderItems)'
                }
            },


            _computeTotalAmount: function (orderItems) {
                var prices = orderItems.map(function (item) {
                    return item.price;
                });
                var total = this._computeSumPrice(prices);
                return total;
            },

            _computeSumPrice: function (prices) {
                var totalPrice = prices.reduce(function (acc, price) {
                    if (!acc.currency) {
                        acc.currency = price.currency;
                    }
                    acc.amount = acc.amount + price.amount;
                    console.log('acc ', acc, 'price', price);
                    return acc;
                }, {amount: 0});
                return totalPrice;
            }

        });
    </script>
</dom-module>
